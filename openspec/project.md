# Project Context

## Purpose

CLASSIC TypeScript is a port of the Python [CLASSIC](https://github.com/evildarkarchon/CLASSIC-Fallout4) (Crash Log Auto Scanner & Setup Integrity Checker) application to TypeScript using the Bun runtime. It analyzes crash logs from Bethesda games to detect issues and provide diagnostic reports.

**Note:** Currently focused on Fallout 4. Skyrim support is architectural (types, game detection) but has no actual crash pattern data.

**Goals:**
- Provide fast, accurate crash log analysis for modded Bethesda games
- Identify problematic mods, plugins, and system configurations
- Generate actionable diagnostic reports with fix suggestions
- Support both CLI and library usage patterns

## Tech Stack

### Core
- **Runtime**: [Bun](https://bun.sh/) v1.0+ (fast JavaScript/TypeScript runtime)
- **Language**: TypeScript 5.x with strict mode
- **Linter/Formatter**: [Biome](https://biomejs.dev/) v1.9+
- **CLI Framework**: [Commander.js](https://github.com/tj/commander.js) v13
- **Output Styling**: [Chalk](https://github.com/chalk/chalk) v5
- **Data Parsing**: [YAML](https://github.com/eemeli/yaml) v2 (for pattern database)
- **Testing**: Bun's built-in test runner

### Desktop GUI (ui/)
- **Framework**: [Electron](https://www.electronjs.org/) v35
- **Frontend**: React 19 + TypeScript
- **Build Tool**: [Vite](https://vitejs.dev/) v6 with vite-plugin-electron
- **Styling**: [Tailwind CSS](https://tailwindcss.com/) v3
- **Packaging**: [electron-builder](https://www.electron.build/) v26

## Project Conventions

### Code Style

Enforced by Biome with these settings:
- **Quotes**: Single quotes (`'string'`)
- **Semicolons**: Always required
- **Trailing commas**: ES5 style (objects, arrays)
- **Indentation**: 2 spaces
- **Line width**: 100 characters
- **Imports**: Auto-organized, unused imports are errors

Naming conventions:
- `camelCase` for variables and functions
- `PascalCase` for types, interfaces, and classes
- `SCREAMING_SNAKE_CASE` for constants
- Files use `kebab-case.ts`

### Architecture Patterns

**Modular Library Structure:**
```
src/
├── cli.ts                 # CLI entry point (Commander.js)
├── index.ts               # Library exports for programmatic use
├── types/index.ts         # Centralized type definitions
└── lib/
    ├── constants.ts       # Application constants
    ├── database/          # Pattern matching database (YAML-backed)
    ├── file-io/           # Async file operations
    ├── message-handler/   # Output system with backend interface
    ├── scan-log/          # Crash log parsing engine
    └── utils/             # Shared utilities
```

**Electron GUI Structure:**
```
ui/
├── electron/
│   ├── main.ts            # Main process (window, IPC handlers)
│   └── preload.ts         # Secure context bridge
├── src/
│   ├── main.tsx           # React entry point
│   ├── App.tsx            # Main application component
│   ├── types.ts           # Frontend type definitions
│   └── components/        # React components
├── package.json           # GUI dependencies + electron-builder config
└── vite.config.ts         # Vite + Electron plugin config
```

**Path Aliases:**
- `@/*` → `src/*`
- `@lib/*` → `src/lib/*`
- `@types/*` → `src/types/*`
- `@cli/*` → `src/cli/*`

**Error Handling:**
- File operations return `FileResult<T>` discriminated union (not thrown exceptions)
- Pattern: `{ success: true, data: T } | { success: false, error: string }`

**Output System:**
- `MessageHandler` singleton with pluggable backends (`OutputBackend` interface)
- Supports CLI, GUI, and file output modes
- Severity-based filtering (debug, info, warning, error, critical)

### Testing Strategy

- **Framework**: Bun's built-in test runner
- **Structure**: `tests/unit/` for unit tests, `tests/integration/` for integration tests
- **Naming**: `*.test.ts` suffix
- **Commands**:
  - `bun test` - Run all tests
  - `bun test --watch` - Watch mode
  - `bun test --coverage` - With coverage report
- **Principle**: Verify APIs before writing tests; fix underlying issues rather than making tests pass superficially

### Git Workflow

- Main branch: `main`
- Feature branches for new work
- Commit messages should be descriptive and focus on "why" not just "what"
- Run `bun run lint` and `bun run typecheck` before committing

## Domain Context

**Bethesda Game Modding:**
- Primary focus: Fallout 4 (Skyrim support is theoretical with no pattern data)
- Crash logs are generated by crash logger mods when the game crashes
- Crash logs contain: headers, call stacks, CPU registers, loaded modules, plugin lists

**Crash Log Analysis:**
- `detectGame()` - Identifies game from log content or filename patterns
- `parseLogSegments()` - Splits logs into typed segments (header, callstack, registers, modules, plugins)
- Pattern database matches known crash signatures to identify problematic mods/configurations
- Issues have severity levels and can include fix suggestions

**Key Terms:**
- **Plugin**: `.esp`, `.esm`, `.esl` files that add/modify game content
- **Module**: DLL files loaded by the game (engine, mods, system)
- **Callstack**: Execution trace at crash time, key to identifying crash source
- **Papyrus**: Bethesda's scripting language (log analysis planned)

## Important Constraints

**TypeScript Strictness:**
- `strict: true` with additional flags enabled
- `exactOptionalPropertyTypes` - Optional properties must be explicitly `undefined`
- `noUncheckedIndexedAccess` - Array/object index access returns `T | undefined`
- `noImplicitReturns` - All code paths must return

**Windows Development:**
- Never output to `nul` (creates undeletable file on Windows)
- Avoid `findstr` (confuses Git Bash)
- Use caution with `sed` for large changes (prefer subagents)

**Performance:**
- Use Bun's native file APIs for async I/O
- Size limits on file reads to prevent memory issues
- Pattern matching should be efficient for large crash logs

## External Dependencies

**Pattern Database:**
- YAML files defining crash patterns, loaded at runtime
- Game-specific filtering (patterns can target Fallout 4, Skyrim, or both)
- Located in data directory (to be ported from Python version)

**Original Python Source:**
- `Code_to_Port/` directory contains reference implementation (read-only)
- Not part of build; excluded from TypeScript compilation

**No External Services:**
- Fully offline operation
- No network calls or external APIs
